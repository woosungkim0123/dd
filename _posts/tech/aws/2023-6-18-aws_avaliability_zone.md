---
title: AWS에서 성능 테스트 시 발생하는 트래픽 비용 주의사항
author: woosungKim
date: 2023-6-18 20:00:00 +0800
categories: [AWS]
tags: [성능 테스트, 비용, AWS]
---

## 요약

1. AWS에서 성능 테스트 시 외부에서 대량의 트래픽을 발생하면 트래픽 비용이 많이 발생한다.
2. 성능테스트를 진행하는 서버와 테스트 대상 서버를 동일한 가용 영역(AZ)에 배치하면 추가 트래픽 비용을 피할 수 있다.

<br>

## 개요

서비스의 품질을 높이기 위해 부하, 스트레스 테스트 등 다양한 성능 테스트를 하게 된다. 성능 테스트에서 대량의 트래픽이 발생하게 되는데 AWS 비용을 줄일 수 있는 방법이 없을까?

<br>

## 문제인식

주니어 A씨가 AWS EC2에 서비스를 하나 배포하였다. 

A씨는 평소에 성능 개선에 관심이 많아서 이번 기회에 JMeter,  nGrinder를 사용해서 성능 테스트를 해보려고 한다.  

자신의 노트북에 nGrinder를 설치하고 AWS EC2에 올려진 자신의 서비스에 대량의 트래픽을 주어 성능 측정을 실험해보았다.  

다음달 A씨는 AWS로 부터 대량의 금액을 청구받고 기절하게 된다.

<br>

## 가용 영역(AZ)

지역(Region, 리전)이 동일해도 다른 가용 영역에 서비스가 있다면 물리적으로 분리된 것이다.

<br>

### 인스턴스 간 통신 비용

AWS에서 EC2 인스턴스 간의 통신 비용은 트래픽의 출발지와 목적지에 따라 달라진다.

**동일한 가용 영역(AZ)**

추가적인 데이터 전송 비용이 발생하지 않는다.   

**다른 가용 영역(AZ)**

동일한 리전 내 다른 가용 영역(AZ)에 있을 경우 데이터 전송 비용이 발생한다.    

**다른 지역(리전) 간의 통신**

다른 리전에 배포된 서비스 간의 통신은 더 높은 데이터 전송 비용이 발생한다.  

**EC2에서 인터넷으로의 통신**

EC2에서 인터넷으로 나가는 트래픽은 비용이 발생한다.   

<br>

### 같은 가용 영역에 서비스를 구축할 경우

#### 장점

1. 데이터 전송 비용 절감  
  
      동일한 AZ 내의 인스턴스들 간의 통신은 추가 비용이 발생하지 않는다.

2. 낮은 지연시간  
  
      같은 AZ 내의 물리적 위치가 가까워 통신 지연시간이 최소화된다.

3. 단순한 네트워크 구성  
      
      모든 리소스가 동일한 AZ 내에 있으므로 네트워크 구성이 단순해진다.

#### 단점

1. 가용성 저하

      한 AZ에 문제가 발생할 경우 해당 AZ에 배포된 모든 인스턴스와 리소스가 영향 받을 수 있다.
    
2. 스케일링 제한
      
      특정 AZ에 리소스가 부족할 경우 추가 인스턴스 배포가 제한될 수 있다. 

3. 재해 복구 제한

      AZ에 문제가 생길 경우 서비스 전체가 중단될 위험이 있으며, 데이터 복구 및 서비스 복원이 제한적이기 때문에 고가용성과 데이터 안정성을 보장하기 어렵다.

<br>

## 해결

성능 테스트할 API서버와 nGrinder Controller EC2 서버, agent서버 2대 총 4대의 서버를 준비하고 모두 같은 가용 영역에 EC2를 배치하게 되면 전송시 발생하는 트래픽 비용이 발생하지 않는다.

