---
title: 서버 용량 부족
author: woosungKim
date: 2022-12-30 20:00:00 +0800
categories: [경험, 회사]
tags: [linux, 서버 문제, migration]
---

## 문제 상황

어느 날 새벽, 사용하던 서버의 Node 프로세스가 갑자기 죽는 사태가 발생.  
해당 서비스는 관리자 유저가 가상 폴더를 생성하고 파일을 저장할 수 있는 기능을 최근에 추가한 상태.  
해당 서비스에 대량의 파일이 업로드 되면서 문제가 발생.

<br>

## 문제 원인

- 고객의 요청 파악 미흡 : 고객이 50여 년 동안의 연혁과 회의 기록 등을 저장할 목적으로 서비스를 사용하려 했던 것을 미리 인지하지 못함.

- 서버 용량 간과: 대량의 파일 업로드에 따른 용량 초과로 인해 서버에 문제가 발생. 이로 인해 과거의 로그 데이터도 일부 유실되었으나 고객의 주요 데이터는 보존됨.

- 로깅 부재: 어떤 파일이 업로드 되었는지에 관한 로그가 없어서 문제를 파악하는데 시간이 걸림.

<br>

## 용량이 부족한 상황에서 왜 프로세스가 종료되었을까?

1. 메모리 부족
    
    스왑 영역 사용 증가로 성능 저하와 메모리 확보 실패로 프로세스 중단 가능성.  

2. 디스크 I/O 병목
   
    저장 공간이 부족한 상황에서 서비스에서 지속적으로 디스크 I/O를 시도하여 연산이 증가하였고 요청이 계속 쌓이면서 프로세스가 '대기' 상태와 '응답 없음' 상태 전환 가능성.  

3. 어플리케이션 내부 오류
   
    디스크 공간 부족으로 발생한 오류 처리 미흡으로 인한 프로세스 중단 가능성.

<br>

## 해결

새로운 1TB 서버를 구축하여 문제를 해결. 
  
데이터 마이그레이션도 순조롭게 진행.

<br>

## 배운점

- 소통의 중요성 : 고객의 요구사항과 서비스의 한계를 미리 파악하고 소통하는 것의 중요성을 다시금 깨달음
- 로깅의 필요성 : 문제가 발생했을 때 원인을 빠르게 찾아내기 위해선 충분한 로그 기록이 필요하다는 것을 깨달음
 