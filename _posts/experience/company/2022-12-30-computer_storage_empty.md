---
title: 서버 용량 부족
author: woosungKim
date: 2022-12-30 20:00:00 +0800
categories: [경험, 회사]
tags: [linux, 서버 문제, migration]
---

<br>
<br>

회사에서 서버 용량이 부족하여 마이그레이션 했던 경험에 대해 이야기 해보고자 한다.

<br>

### 문제 발생

서비스에 관리자가 가상의 폴더를 만들고 파일을 저장하고 유저가 그걸 읽거나 다운받을 수 있는 시스템을 만들었다.

그 날 새벽, 서비스가 지속적으로 죽는 문제가 발생 하였고 새로 켜지더라도 어플리케이션의 성능이 매우 느려지는 문제가 발생하였다.

과거 로그 파일도 일부 유실된 걸로 확인되었다.

<br>

### 문제 원인

관리자가 새벽에 대량의 파일을 업로드하면서 서버의 용량이 모두 차게 되었고 그 상황에 지속적인 업로드 시도로 인해 서버가 죽었다 켜졌다를 반복한 것으로 확인되었다.

고객이 어떤 목적으로 얼마 만큼의 데이터를 저장할 것인지 사전에 파악하지 못해 생긴 문제였다.

그리고 어떤 파일이 업로드 되었는지 등에 관한 로그를 남기지 않아 문제를 파악하는데 시간이 오래 걸렸다.

다행히 과거의 로그 데이터가 일부 유실되었으나 고객의 주요 데이터는 모두 보존되었다.

<br>

### 서버가 종료된 이유에 대한 생각

첫번째로 메모리 부족에 대해 생각해볼 수 있다. 

메모리가 부족하면 시스템은 가상메모리인 스왑 영역을 사용하게 되는데 이러한 스왑 영역은 HDD나 SSD에 위치하므로 실제 RAM에 비해 접근 속도가 느리다. 

따라서 스왑 영역의 사용이 증가로 인해 시스템의 성능이 저하되었다고 생각해볼 수 있다. 그리고 용량 초과로 인해 스왑 영역도 충분히 확보하지 못하였을 것이고 프로세스는 메모리 부족으로 종료되었을 가능성이 있다.

<br>

두번째로 고려해볼 사항은 디스크 I/O 병목 현상이다.

디스크의 저장 용량이 점점 부족해지거나 여러 프로세스나 애플리케이션들로부터 디스크에 대한 I/O 요청이 증가하여 처리 능력을 초과하면, 디스크 I/O 병목 현상이 발생한다.

이런 병목 현상으로 인해 프로세스가 디스크에서 필요한 데이터를 읽거나 쓰는 데 필요한 시간이 길어지게 되고 프로세스의 반응성이 저하될 수 있다.

지속적인 병목이 발생할 경우 프로세스는 '대기' 상태나 '응답 없음' 상태로 전환될 수 있고 이러한 상황이 지속되어 프로세스가 종료되었을 가능성이 있다.

<br>

세번째는 어플리케이션 내부에 오류를 생각해볼 수 있다.

디스크 공간 부족으로 발생한 오류를 처리하지 못해 그대로 서버의 프로세스가 중단 되었을 가능성이 있다.

<br>

### 결과

문제를 해결하기 위해 1TB 용량의 새로운 서버로 데이터를 마이그레이션 하였다.

이 경험을 통해 기능 구현에 있어서 단순히 기능의 작동 방식만을 고려하는 것이 아니라, 그 기능이 왜 필요한지, 그리고 그 기능을 위해 어느 정도의 자원이 필요한지에 대한 사전 평가의 중요성을 알게 되었다.

그리고 문제가 발생했을 때 원인을 빠르게 찾아내기 위해서 충분한 로그 기록이 필요하다는 것도 느끼게 되었다.

