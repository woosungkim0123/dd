---
title: Node 서버 마이그레이션의 과정과 후기
author: woosungKim
date: 2022-11-10 19:00:00 +0800
categories: [경험, 회사]
tags: [node.js, migration]
---

## 버전 변경 정보

- 기존 버전: Node v0.10.48
- 변경된 버전: Node v14.17.0

<br>

## 필요성

- 이미지 압축 문제: 고화질의 이미지 로딩 지연 문제로 이미지 압축 라이브러리 도입 필요성.
- 코드 구조 문제: 1000줄 이상의 복잡한 코드로 라우팅 및 설정이 혼재.
- ES6 문법 지원: 기존의 노드 버전에서는 ES6 문법 사용이 제한적.

<br>

## 방법

1. 새 서버 구축: Cafe24에서 Node.js 14버전으로 가상 호스팅 서버 구매 및 설치.
2. 라우팅 설정: Apache Vhost를 통한 라우팅 설정.
3. SSL 인증: 기존 서버의 SSL 인증 정보 사용.
4. 무중단 운영: PM2를 활용.

<br>

## 결과

- 성능 향상: 이미지 로딩시간 3초 -> 1초 감소.
- 코드 최적화: app.js 코드 줄임 (1000줄 -> 100줄) 및 리팩토링 진행.
- 코드 스타일 변경: 함수형 코드에서 클래스형 코드로 변환.
- 버전 표준화: 이후 프로젝트들도 14버전을 기준으로 진행.

<br>

## 2023년 추가 생각

### 도커 활용
  - 마이그레이션 전 서버에 리소스가 많이 남아 있었는데 기존 노드 버전의 충돌 때문에 마이그레이션을 진행하였고 그 당시 도커를 알고 사용했다면 버전 충돌 없이 프로젝트를 올릴 수 있었을 것 같음
  
### 코드 컨벤션
  - 마이그레이션 이후 코드 스타일의 대폭적인 변경으로 인해 기존 인원들의 유지보수의 어려움을 예상
  - controller에 응집된 코드를 나누는 건 괜찮은 선택이였던 것 같은데 함수로 된 코드들을 모두 Class 형태로 작성한 건 잘한 선택이 아니였던 것 같음

### 서버 구축 전략
  - 마이그레이션 당시에는 해당 프로젝트만을 생각하여서 크지 않은 가상 서버를 사용
  - 하지만 추후 프로젝트들이 14버전으로 만들어 지는것 까지 고려하였다면 더 큰 서버를 구매하는게 맞는 선택일 것 같음
  - 추가로 이후에 서버 용량 문제가 발생하여서 마이그레이션을 한번 더 진행함 ([**서버 용량 부족 문제**](/posts/computer_storage_empty))