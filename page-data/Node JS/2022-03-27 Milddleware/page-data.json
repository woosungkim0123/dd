{
    "componentChunkName": "component---src-templates-post-template-tsx",
    "path": "/Node JS/2022-03-27 Milddleware/",
    "result": {"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2>Milddleware에 대해 알아보자</h2>\n<h3>개념</h3>\n<p>중간에 있는 소프트웨어</p>\n<br>\n<p>브라우저가 request하면 서버가 응답하기 전에 그 사이에 middleware가 있음</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">privateMiddleware</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> req<span class=\"token punctuation\">.</span>url\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>url <span class=\"token operator\">===</span> <span class=\"token string\">'/protected'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;h1>Not allowed&lt;/h1>'</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token punctuation\">}</span>\r\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 다음 함수를 호출해준다</span>\r\n<span class=\"token punctuation\">}</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleHome</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token comment\">// 사실 이 부분에서도 next 사용 가능</span>\r\n  <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">)</span>\r\n  <span class=\"token comment\">// res.end : 끝내는거</span>\r\n  <span class=\"token comment\">// res.send : 보내는거</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> privateMiddleware<span class=\"token punctuation\">,</span> handleHome<span class=\"token punctuation\">)</span>\r\n<span class=\"token comment\">// '/' 부분이 route</span>\r\n<span class=\"token comment\">// '/'로 get요청이 오면 express는 콜백함수에 req object res object를 넣어줌</span>\r\n<span class=\"token comment\">// 뒤에 함수를 handler(controller)라고 함</span>\r\n<span class=\"token comment\">// 여기서 privateMiddleware과 handleHome은 컨트롤러</span>\r\n<span class=\"token comment\">// 사실 모든 컨트롤러(handler)는 미들웨어임</span>\r\n<span class=\"token comment\">// 마지막에 응답을 하는 컨트롤러를 미들웨어라 부르지 않는 것일뿐</span></code></pre></div>\n<p>컨트롤러에는 총 3개의 인자(req, res, next)가 있고 next는 미들웨어에서 다음 함수로 이동할 때 사용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// app.use는 global middleware</span>\r\n<span class=\"token comment\">// 순서가 중요(맨 위부터 차례대로 실행되기 때문)</span>\r\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> handleHome<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 미들웨어가 적용되지않음</span>\r\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">)</span>\r\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>privateMiddleware<span class=\"token punctuation\">)</span>\r\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> handlePrivate<span class=\"token punctuation\">)</span></code></pre></div>\n<br>\n<p>req와 관련된 모든 컨트롤러는 res(응답)하기전까지는 전부 middleware</p>\n<h3>morgan</h3>\n<p>자주 쓰이는 미들웨어</p>\n<br>\n<p>설치후 함수호출후 설정해야함</p>\n<br>\n<p>morgan 함수를 호출하면 설정한대로 middleware를 return 해줌</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> morgan <span class=\"token keyword\">from</span> <span class=\"token string\">'morgan'</span>\r\n<span class=\"token keyword\">const</span> logger <span class=\"token operator\">=</span> <span class=\"token function\">morgan</span><span class=\"token punctuation\">(</span><span class=\"token string\">'common'</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// common은 설정부분</span>\r\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 미들웨어로 호출</span></code></pre></div>","fields":{"slug":"/Node JS/2022-03-27 Milddleware/"},"frontmatter":{"title":"Milddleware","summary":"Milddleware(미들웨어)","date":"2022.03.27.","categories":["NodeJS"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8UlEQVQoz52T7WrCUAyGe/+X0AvoX4f7RBi9gFGETfZnCGIZrNha9ByPiCd5RpWCK21nDYQEcvLyJOQEdJiqtsZm3rTgGjHnz3EvilzU2oSD/wgrsS+nvFtlZpXNUXspOwnrhsVeeS2FcS48FsLn7gbC+mFFMzXKZC2MVsJ9LrxtlZ9DN2UP4Slj7oRJ4Rnnnodc+DD+zx6v3mHddATmB5g6mDnYNeqDRt4aQ5IkfBcl5bpgtTEslkuMMcNHrizLMsIwZHw3IooiXp6fiOOYNE3PlCLD77BqstaeqIy1OOfw3g/fYd9vuOkOL2+tzbsIfwEPDa31cI0wfgAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/bf3fa5e09a7d77ec7556f0458691eb7a/74e29/React.png","srcSet":"/static/bf3fa5e09a7d77ec7556f0458691eb7a/98324/React.png 97w,\n/static/bf3fa5e09a7d77ec7556f0458691eb7a/74d80/React.png 193w,\n/static/bf3fa5e09a7d77ec7556f0458691eb7a/74e29/React.png 386w","sizes":"(min-width: 386px) 386px, 100vw"},"sources":[{"srcSet":"/static/bf3fa5e09a7d77ec7556f0458691eb7a/865bc/React.webp 97w,\n/static/bf3fa5e09a7d77ec7556f0458691eb7a/918e8/React.webp 193w,\n/static/bf3fa5e09a7d77ec7556f0458691eb7a/1875a/React.webp 386w","type":"image/webp","sizes":"(min-width: 386px) 386px, 100vw"}]},"width":386,"height":225}}}}}}]}},"pageContext":{"slug":"/Node JS/2022-03-27 Milddleware/"}},
    "staticQueryHashes": []}